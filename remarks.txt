Compile:
========
cd bin
javac -cp /usr/share/java/jcifs.jar:/usr/share/java/log4j-1.2.jar -d . ../src/tm/mao/cbf/*.java

Run:
========
java -cp .:/usr/share/java/jcifs.jar:/usr/share/java/log4j-1.2.jar tm.mao.cbf.CleanBackupFolders

или

jar cfm CleanBackupFolders.jar manifest.txt tm/*
java -jar CleanBackupFolders.jar

Выделение цветом:
=================
log.info((char)27 + "[37;41m" + f.getName() + (char)27 + "[0m  <-- expired");

Общий алгоритм - Собрать список из дней, когда оставлять бэкапы, далее проходить по всем файлам и удалять неподходящие бэкапы. Также проверять размеры бэкапов (могут быть пустыми).


Создаем список
Если нужны дневные бэкапы:
	Заполняем его именами файлов (здесь и далее под файлом подразумеваются и каталоги) дневных бэкапов

Если нужны недельные бэкапы:
	Сдвигаемся на сутки вниз. Ищем вниз по дате бэкап датой ближайшего опорного дня недели (если нужны недельные бэкапы). С этого дня отсчитываем недельные бэкапы и если файл существует, заносим его в список

Если нужны месячные бэкапы:
	Определяем месяц и год, в котором находимся (с учетом нумерации месяцев в java)
	Берем первое число месяца и ищем дату опорного бэкапа
	Перемещаемся на месяц назад и снова повторяем процесс поиска опорного бэкапа

	Сдвигаемся на сутки вниз. Определяем месяц, в котором находимся, определяем, какой день недели приходится на это число и является ли этот день опорным. Если нет, ищем вверх ближайший опорный бэкап и фиксируем его в списке. Сдвигаемся на месяц ниже и повторяем процедуру для всех оставшихся месячных бэкапов. Ловушка - переход через январь-декабрь!

Если нужны ежегодные бэкапы:
	Определяем текущий год, на котором остановились. Берем 1-е января и ищем вверх ближайший опорный день. Фиксируем в списке, уменьшаем год и повторяем процедуру. Найденные бэкапы фиксируем в списке.
Далее просматриваем каталог бэкапа и проверяем каждый элемент на запись в нашем списке. Если он там не обнаружен, удаляем его с диска с фиксацией в логе.



Планируемые изменения:
======================

1. Шаблоны поиска папок/файлов:
	1.1. по дате папки/файла (создание или модификация)
	1.2. по дате в имени папки/файла (например, npr_2020-11-05_2100.gbk или 20190105T2000), т.е. пробегаемся по датам и ищем папки/файлы по шаблону (например, npr_YYYY-MM-DD_2100.gbk или npr_YYYY-MM-DD_*.gbk)

2. Файлы настроек:
	2.1. Список бэкапов (или отдельные списки в подкаталоге /conf.d). Формат:

		# БД Firebird Search <--- комментарии
		Backup=FIREBIRD_SEARCH <--- идентификатор бэкапа
		Description=Полные бэкапы БД Firebird для Search <--- описание
		AuthServer=NETAPP1 <--- авторизационные данные (сервер, шара, протокол)
		Folder=s4 <--- папка на ресурсе
		Days=7  <--- количество сохраняемых ежедневных копий
		Weeks=4 <--- количество сохраняемых еженедельных копий
		Monthes=10 <--- количество сохраняемых ежемесячных копий
		Years=3 <--- количество сохраняемых ежегодных копий
		MasterDay=5  <--- опорный день недели (бекап в котором надо сохранить и от него отсчитывать остальные копии). Предусмотреть обработку без опорных дней
		DateLimit=2017.05.01 <--- дата, ранее которой бэкапы не обрабатывать (чтобы бэкапы, которые откуда-то переписаны, не были удалены, или при изменении условий бэкапа (к примеру, смена опорного дня) предусмотреть ситуацию с удалением старых бэкапов, теперь не удовлетворяющих условиям сохранения)

	2.2. Авторизационные данные, формат XML:

		<?xml version="1.0" encoding="UTF-8" standalone="yes"?>

		<AuthData>
    		    <AuthServer id="NETAPP1">
        		        <Description>Полные бэкапы 1</Description>
            		    <Type>SMB</Type>
                		<Server>172.16.4.23</Server>
		                <Share>Backup_file</Share>
    		            <Domain>contoso</Domain>
        		        <User>admin</User>
            		    <Password>12345678</Password>
		        </AuthServer>
    		    <AuthServer id="QNAPMSK1">
        		        <Description>Полные бэкапы VM</Description>
            		    <Type>NFS</Type>
                		<Server>10.44.1.3</Server>
		                <Share>xenserver</Share>
    		            <User>admin</User>
        		        <Password>NAS001</Password>
	        	</AuthServer>
	        	<AuthServer id="BACKUPSRV">
    		    	    <Description>Локальные бэкапы</Description>
        	        	<Type>Local</Type>
						<Share>c:\backup\</Share>
	        	</AuthServer>
	    	    <AuthServer id="FTPCHEL">
    	    	        <Description>Бэкапы телефонии</Description>
        	    	    <Type>FTP</Type>
            	    	<FtpServer>10.24.1.3</FtpServer>
	            	    <User>admin</User>
    	            	<Password>NASserver001</Password>
	        	</AuthServer>
		        <AuthServer id="SAPHANA">
    		            <Description>Бэкапы SAP HANA</Description>
        		        <Type>SSH</Type>
            		    <Server>tapebuf</Server>
                		<User>admin</User>
		                <Password>ssh002</Password>
    		    </AuthServer>
		</AuthData>


